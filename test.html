<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>

        function configWxShare(a){
            wx.config({
                debug: true,
                appId: a.appid,
                timestamp: a.timestamp,
                nonceStr: a.nonceStr,
                signature: a.signature,
                jsApiList: [
                    'checkJsApi',
                    'onMenuShareTimeline',
                    'onMenuShareAppMessage',
                    'onMenuShareQQ',
                    'onMenuShareWeibo'
                ]
            });
            //分享地址
            var sharePath=a.url;
            //分享图像
            var shareImg="http://h5n.180china.com/test2.jpg";
            wx.ready(function(){
                // 分享到朋友圈
                wx.onMenuShareTimeline({
                    title: '这只是一个测试', // 分享标题
                    link: sharePath, // 分享链接
                    imgUrl: shareImg, // 分享图标
                    success: function () {
                        //用户确认分享后执行的回调函数
                        alert("ok");
                        //$.ajax({
                        //    type: "GET",
                        //    url: "/wx-help/send-red-pack",
                        //    data: "openid=<?//= $openid;?>//",
                        //    success: function(msg){
                        //        alert(msg);
                        //    },
                        //    error : function(XMLHttpRequest, textStatus, errorThrown){
                        //        alert(XMLHttpRequest);
                        //        alert(textStatus);
                        //        alert(errorThrown);
                        //    }
                        //});
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
                //分享给朋友
                wx.onMenuShareAppMessage({
                    title: '这只是一个测试', // 分享标题
                    desc: '这只是一个测试描述', // 分享描述
                    link: sharePath, // 分享链接
                    imgUrl: shareImg, // 分享图标
                    type: 'link', // 分享类型,music、video或link，不填默认为link
                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                    success: function () {
                        alert("ok");
                        // 用户确认分享后执行的回调函数
                        //$.ajax({
                        //    type: "GET",
                        //    url: "/wx-help/send-red-pack",
                        //    data: "openid=<?//= $openid;?>//",
                        //    success: function(msg){
                        //        alert(msg);
                        //    },
                        //    error : function(XMLHttpRequest, textStatus, errorThrown){
                        //        alert(XMLHttpRequest);
                        //        alert(textStatus);
                        //        alert(errorThrown);
                        //    }
                        //});
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
            });
        }


        $.ajax({
            url: '/wx-help/get-wx-config',
            type: "POST",
            dataType:"json",
            success: function (msg) {
                configWxShare(msg);
            }
        });

    </script>
</head>
<body>
    <h1>只是一个测试</h1>
</body>
</html>

